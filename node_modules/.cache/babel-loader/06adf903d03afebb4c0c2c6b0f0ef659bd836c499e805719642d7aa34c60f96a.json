{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\celst\\\\sds\\\\src\\\\components\\\\GrowthSimulation.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Line } from 'react-chartjs-2';\nimport { Chart as ChartJS, LineElement, PointElement, Tooltip, Legend, CategoryScale, LinearScale, Title, Interaction } from 'chart.js';\nimport { getElementAtEvent } from 'react-chartjs-2';\nimport odeRK4 from 'ode-rk4';\n\n// --- CSS and Asset Imports ---\n// Adjust these paths according to your project structure\nimport '../styles/GrowthSimulation.css';\nimport logoSrc from '../assets/images/cslogo.png';\nimport asset1Src from '../assets/images/my100.jpg'; // Image for Day 0-2 click\nimport day1Src from '../assets/images/Day1.jpg'; // Image for Day 8-15 click\nimport day5Src from '../assets/images/Day5.jpg'; // Image for Day 35-40 click\n\n// --- Simulation Logic & ChartJS Registration ---\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nChartJS.register(LineElement, PointElement, Tooltip, Legend, CategoryScale, LinearScale, Title);\n\n// *** Default Parameters & Simulation Functions ***\n// (Assume defaultParamsMushroom, defaultParamsMycelium, FIXED_CN_RATIO,\n// linearInterpolate, derivatives, getInitialState, runSimulation are unchanged)\n// *** Default Parameters for MUSHROOM Growth ***\nconst defaultParamsMushroom = {\n  timeStart: 0,\n  timeLength: 100,\n  timeStep: 0.2,\n  'C BD Rate': 1.11,\n  'C Coeff': 0.7,\n  'C Cons. Rate': 76.39,\n  'CO2 Coeff': 0.8,\n  'CO2 Production Rate': 410000,\n  'CO2 Removal Rate': 12.6,\n  'External CO2': 428.23,\n  'External Temp': 24,\n  'Growth Coeff': 5.1,\n  'Initial Complex:Simple Ratio': 0.8054,\n  'Initial Dry Substrate Weight': 410.2,\n  'IsMush': 1,\n  'Mushroom Multiplier': 5.17,\n  'N Coeff': 68.4,\n  'N Rate': 13.03,\n  'pH': 6.91,\n  'pH Coeff': 1.4,\n  'Temp Coeff': 1.3,\n  'Temp Production Rate': 405,\n  'Temp Transfer Rate': 1.5,\n  'Effect of CO2 on Mush Growth Data': [[500, 0.9], [800, 1], [1000, 0.8], [1200, 0.25], [1400, 0]],\n  'Effect of CO2 on Myc Growth Data': [[15000, 1], [20000, 0.9], [25000, 0.25], [30000, 0]],\n  'Effect of pH on Mush Growth Data': [[5.5, 0], [6, 0.25], [6.7, 1], [7, 0.6], [7.5, 0]],\n  'Effect of pH on Myc Growth Data': [[5.8, 0], [6, 0.25], [6.7, 1], [7, 0.6], [7.5, 0]],\n  'Effect of Temp on Mush Growth Data': [[10, 0], [15, 5.37], [20, 6.36], [25, 8.63], [30, 6.37], [40, 0]],\n  'Effect of Temp on Myc Growth Data': [[10, 0], [15, 5.37], [20, 6.36], [25, 8.63], [30, 6.37], [35, 5.36], [45, 0]],\n  'Initial Mycelium': 0.9\n};\n// *** Default Parameters for MYCELIUM Growth ***\nconst defaultParamsMycelium = {\n  timeStart: 0,\n  timeLength: 100,\n  timeStep: 0.2,\n  'C BD Rate': 1.11,\n  'C Coeff': 0.7,\n  'C Cons. Rate': 76.39,\n  'CO2 Coeff': 0.8,\n  'CO2 Production Rate': 410000,\n  'CO2 Removal Rate': 1,\n  'External CO2': 428.23,\n  'External Temp': 28,\n  'Growth Coeff': 5.4,\n  'Initial Complex:Simple Ratio': 0.867,\n  'Initial Dry Substrate Weight': 200,\n  'IsMush': 0,\n  'Mushroom Multiplier': 26,\n  'N Coeff': 68.4,\n  'N Rate': 1.53,\n  'pH': 6.91,\n  'pH Coeff': 1.4,\n  'Temp Coeff': 1.7,\n  'Temp Production Rate': 255,\n  'Temp Transfer Rate': 1.5,\n  'Effect of CO2 on Mush Growth Data': [[500, 0.9], [800, 1], [1000, 0.8], [1200, 0.25], [1400, 0]],\n  'Effect of CO2 on Myc Growth Data': [[15000, 1], [20000, 0.9], [25000, 0.25], [30000, 0]],\n  'Effect of pH on Mush Growth Data': [[5.5, 0], [6, 0.25], [6.7, 1], [7, 0.6], [7.5, 0]],\n  'Effect of pH on Myc Growth Data': [[5.8, 0], [6, 0.25], [6.7, 1], [7, 0.6], [7.5, 0]],\n  'Effect of Temp on Mush Growth Data': [[10, 0], [15, 5.37], [20, 6.36], [25, 8.63], [30, 6.37], [40, 0]],\n  'Effect of Temp on Myc Growth Data': [[10, 0], [15, 5.37], [20, 6.36], [25, 8.63], [30, 6.37], [35, 5.36], [45, 0]],\n  'Initial Mycelium': 0.004\n};\n// FIXED C:N Ratio\nconst FIXED_CN_RATIO = 0.96;\n// --- Simulation Functions ---\nfunction linearInterpolate(data, x) {\n  if (!data || data.length === 0) return 0;\n  if (x <= data[0][0]) return data[0][1];\n  if (x >= data[data.length - 1][0]) return data[data.length - 1][1];\n  let i = 0;\n  while (i < data.length - 1 && x > data[i + 1][0]) i++;\n  const x0 = data[i][0],\n    y0 = data[i][1];\n  const x1 = data[i + 1][0],\n    y1 = data[i + 1][1];\n  const divisor = x1 - x0;\n  if (divisor === 0) return y0;\n  const t = (x - x0) / divisor;\n  return y0 + t * (y1 - y0);\n}\nfunction derivatives(dydt, y, t, currentParams) {\n  const [currentCO2, currentComplexC, currentMushroomYield, currentMycelium, currentN, currentSimpleC, currentSpace, currentTemp] = y;\n  const initialDrySubstrateWeight = currentParams['Initial Dry Substrate Weight'] || 1;\n  const cnRatio = currentParams['Initial C:N Ratio'];\n  const cnRatioPlusOne = cnRatio + 1;\n  const InitC = initialDrySubstrateWeight - initialDrySubstrateWeight / cnRatioPlusOne;\n  const AvailableN = initialDrySubstrateWeight > 0 ? currentN / initialDrySubstrateWeight : 0;\n  const AvailableC = initialDrySubstrateWeight > 0 ? currentSimpleC / initialDrySubstrateWeight : 0;\n  const VolumeNormalisation = initialDrySubstrateWeight > 0 ? Math.sqrt(100 / initialDrySubstrateWeight) : Math.sqrt(100);\n  const Effect_of_CO2_on_Mush_Growth = linearInterpolate(currentParams['Effect of CO2 on Mush Growth Data'], currentCO2);\n  const Effect_of_CO2_on_Myc_Growth = linearInterpolate(currentParams['Effect of CO2 on Myc Growth Data'], currentCO2);\n  const Effect_of_pH_on_Mush_Growth = linearInterpolate(currentParams['Effect of pH on Mush Growth Data'], currentParams['pH']);\n  const Effect_of_pH_on_Myc_Growth = linearInterpolate(currentParams['Effect of pH on Myc Growth Data'], currentParams['pH']);\n  const Effect_of_Temp_on_Mush_Growth = linearInterpolate(currentParams['Effect of Temp on Mush Growth Data'], currentTemp);\n  const Effect_of_Temp_on_Myc_Growth = linearInterpolate(currentParams['Effect of Temp on Myc Growth Data'], currentTemp);\n  const isMushPhase = currentParams['IsMush'] === 1;\n  const TempEff_ = isMushPhase ? Effect_of_Temp_on_Mush_Growth : Effect_of_Temp_on_Myc_Growth;\n  const TempEffect = currentParams['Temp Coeff'] * TempEff_ / 10;\n  const pHEff_ = isMushPhase ? Effect_of_pH_on_Mush_Growth : Effect_of_pH_on_Myc_Growth;\n  const pHEffect = pHEff_ * currentParams['pH Coeff'];\n  const CO2Eff_ = isMushPhase ? Effect_of_CO2_on_Mush_Growth : Effect_of_CO2_on_Myc_Growth;\n  const CO2Effect = currentParams['CO2 Coeff'] * CO2Eff_;\n  const NEffect = currentParams['N Coeff'] * AvailableN;\n  const CEffect = Math.sqrt(Math.max(0, currentParams['C Coeff'] * AvailableC));\n  const safeTempEffect = Math.max(0, TempEffect);\n  const safePhEffect = Math.max(0, pHEffect);\n  const safeNEffect = Math.max(0, NEffect);\n  const safeCEffect = Math.max(0, CEffect);\n  const safeCO2Effect = Math.max(0, CO2Effect);\n  const RawGrowthRate = safeTempEffect * safePhEffect * safeNEffect * safeCEffect * safeCO2Effect;\n  const GrowthOpp = currentSpace * currentMycelium;\n  let GrowthRate = isMushPhase ? RawGrowthRate * currentParams['Growth Coeff'] : RawGrowthRate * GrowthOpp * currentParams['Growth Coeff'];\n  GrowthRate = Math.max(0, GrowthRate);\n  let NormGrowthRate = isMushPhase ? GrowthRate / 100 : GrowthRate;\n  NormGrowthRate = Math.max(0, NormGrowthRate);\n  const flow_Breakdown = Math.max(0, currentMycelium * currentParams['C BD Rate'] * currentComplexC * RawGrowthRate * VolumeNormalisation);\n  const flow_CCons = Math.max(0, NormGrowthRate * currentParams['C Cons. Rate']);\n  const flow_CO2Prod = Math.max(0, NormGrowthRate * currentParams['CO2 Production Rate']);\n  const flow_CO2Vent = Math.max(0, currentParams['CO2 Removal Rate'] * (currentCO2 - currentParams['External CO2']) * VolumeNormalisation);\n  const flow_Colonisation = isMushPhase ? 0 : GrowthRate;\n  const flow_MushroomGrowth = isMushPhase ? Math.max(0, GrowthRate * currentParams['Mushroom Multiplier']) : 0;\n  const flow_NCons = Math.max(0, NormGrowthRate * currentParams['N Rate']);\n  const flow_TempProd = Math.max(0, NormGrowthRate * currentParams['Temp Production Rate']);\n  const flow_TempVent = Math.max(0, (currentTemp - currentParams['External Temp']) * currentParams['Temp Transfer Rate'] * VolumeNormalisation);\n  dydt[0] = flow_CO2Prod - flow_CO2Vent;\n  dydt[1] = -flow_Breakdown;\n  dydt[2] = flow_MushroomGrowth;\n  dydt[3] = flow_Colonisation;\n  dydt[4] = -flow_NCons;\n  dydt[5] = flow_Breakdown - flow_CCons;\n  dydt[6] = -flow_Colonisation;\n  dydt[7] = flow_TempProd - flow_TempVent;\n  const epsilon = 1e-9;\n  if (y[0] <= epsilon && dydt[0] < 0) dydt[0] = 0;\n  if (y[1] <= epsilon && dydt[1] < 0) dydt[1] = 0;\n  if (y[2] <= epsilon && dydt[2] < 0) dydt[2] = 0;\n  if (y[3] <= epsilon && dydt[3] < 0) dydt[3] = 0;\n  if (y[4] <= epsilon && dydt[4] < 0) dydt[4] = 0;\n  if (y[5] <= epsilon && dydt[5] < 0) dydt[5] = 0;\n  if (y[6] <= epsilon && dydt[6] < 0) dydt[6] = 0;\n}\nfunction getInitialState(p, initialMyceliumValue) {\n  const initialDrySubstrateWeight = Number(p['Initial Dry Substrate Weight']);\n  const cnRatio = Number(p['Initial C:N Ratio']);\n  const complexSimpleRatio = Number(p['Initial Complex:Simple Ratio']);\n  if (isNaN(initialDrySubstrateWeight) || initialDrySubstrateWeight <= 0 || isNaN(cnRatio) || cnRatio <= 0 || isNaN(complexSimpleRatio) || complexSimpleRatio < 0 || complexSimpleRatio > 1) {\n    console.error(\"Invalid parameters for getInitialState:\", p);\n    return [400, 200, 0, 0.01, 10, 50, 0.99, 25];\n  }\n  const cnRatioPlusOne = cnRatio + 1;\n  const Init_N = initialDrySubstrateWeight / cnRatioPlusOne;\n  const Init_C = initialDrySubstrateWeight - Init_N;\n  const initialSpace = Math.max(0, 1 - initialMyceliumValue);\n  return [Number(p['External CO2']), Init_C * complexSimpleRatio, 0, initialMyceliumValue, Init_N, Init_C * (1 - complexSimpleRatio), initialSpace, Number(p['External Temp'])];\n}\nfunction runSimulation(inputParams, defaultParamSet) {\n  var _currentParams$Initia, _currentParams$Initia2;\n  if (!defaultParamSet) {\n    console.error(\"runSimulation called without defaultParamSet!\");\n    return [];\n  }\n  const currentParams = {\n    ...defaultParamSet,\n    ...inputParams,\n    'Initial C:N Ratio': FIXED_CN_RATIO\n  };\n  const finalInitialWeight = Number(currentParams['Initial Dry Substrate Weight']);\n  const finalCNRatio = Number(currentParams['Initial C:N Ratio']);\n  const finalComplexSimpleRatio = Number(currentParams['Initial Complex:Simple Ratio']);\n  const finalExternalCO2 = Number(currentParams['External CO2']);\n  const finalExternalTemp = Number(currentParams['External Temp']);\n  const initialMyceliumValue = currentParams['IsMush'] === 0 ? (_currentParams$Initia = currentParams['Initial Mycelium']) !== null && _currentParams$Initia !== void 0 ? _currentParams$Initia : defaultParamsMycelium['Initial Mycelium'] : (_currentParams$Initia2 = currentParams['Initial Mycelium']) !== null && _currentParams$Initia2 !== void 0 ? _currentParams$Initia2 : defaultParamsMushroom['Initial Mycelium'];\n  const initialStateParams = {\n    'Initial Dry Substrate Weight': finalInitialWeight,\n    'Initial C:N Ratio': finalCNRatio,\n    'Initial Complex:Simple Ratio': finalComplexSimpleRatio,\n    'External CO2': finalExternalCO2,\n    'External Temp': finalExternalTemp\n  };\n  const y0 = getInitialState(initialStateParams, initialMyceliumValue);\n  const t0 = currentParams.timeStart;\n  const dt = currentParams.timeStep;\n  const timeLength = Math.max(0, Number(currentParams.timeLength));\n  const positiveDt = Math.max(dt, 1e-6);\n  const numSteps = timeLength > 0 && positiveDt > 0 ? Math.floor(timeLength / positiveDt) : 0;\n  const derivativeFuncForSolver = (dydt, y, t) => {\n    try {\n      derivatives(dydt, y, t, currentParams);\n    } catch (e) {\n      console.error(\"Error inside derivatives function:\", e);\n      dydt.fill(0);\n    }\n  };\n  const integrator = odeRK4(y0, derivativeFuncForSolver, t0, positiveDt);\n  const results = [{\n    time: integrator.t,\n    state: [...integrator.y]\n  }];\n  const simType = currentParams['IsMush'] === 0 ? 'Mycelium' : 'Mushroom';\n  if (numSteps <= 0) {\n    console.warn(`${simType} Sim: 0 steps. Simulation not run.`);\n    return [];\n  }\n  for (let i = 0; i < numSteps; i++) {\n    try {\n      integrator.step();\n      if (integrator.y.some(val => !Number.isFinite(val))) {\n        console.error(`${simType} Sim: Non-finite value at t=${integrator.t.toFixed(2)}. State:`, integrator.y);\n      }\n      results.push({\n        time: integrator.t,\n        state: [...integrator.y]\n      });\n    } catch (solverError) {\n      console.error(`${simType} Sim: Solver error at t=${integrator.t.toFixed(2)}:`, solverError);\n      break;\n    }\n  }\n  return results.map(p => ({\n    time: p.time,\n    CO2: p.state[0],\n    ComplexC: p.state[1],\n    MushroomYield: p.state[2],\n    Mycelium: p.state[3],\n    N: p.state[4],\n    SimpleC: p.state[5],\n    Space: p.state[6],\n    Temp: p.state[7]\n  }));\n}\n// --- (End of Simulation Functions) ---\n\n// --- Helper Functions ---\nfunction formatDate_DDMMYYYY(dateString) {\n  if (!dateString || dateString === 'N/A' || !/^\\d{4}-\\d{2}-\\d{2}$/.test(dateString)) {\n    return 'N/A';\n  }\n  try {\n    const [year, month, day] = dateString.split('-');\n    return `${day}-${month}-${year}`;\n  } catch (e) {\n    console.error(\"Error formatting date:\", e);\n    return 'N/A';\n  }\n}\nfunction calculateAndFormatEndDate(startDateStr, durationDays) {\n  if (!startDateStr || startDateStr === 'N/A' || !/^\\d{4}-\\d{2}-\\d{2}$/.test(startDateStr) || isNaN(durationDays) || durationDays < 0) {\n    return 'N/A';\n  }\n  try {\n    const startDateObj = new Date(startDateStr);\n    const endDateObj = new Date(startDateObj.getTime());\n    endDateObj.setDate(endDateObj.getDate() + durationDays);\n    const endYear = endDateObj.getFullYear();\n    const endMonth = String(endDateObj.getMonth() + 1).padStart(2, '0');\n    const endDay = String(endDateObj.getDate()).padStart(2, '0');\n    const endDateStrYYYYMMDD = `${endYear}-${endMonth}-${endDay}`;\n    return formatDate_DDMMYYYY(endDateStrYYYYMMDD);\n  } catch (dateError) {\n    console.error(\"Error calculating end date:\", dateError);\n    return 'N/A';\n  }\n}\n\n// --- React Component Definition ---\nconst GrowthSimulation = () => {\n  _s();\n  const navigate = useNavigate();\n  const chartRef = useRef(null);\n\n  // --- State Variables ---\n  // Simulation results and UI state\n  const [simulationResultsMushroom, setSimulationResultsMushroom] = useState(null);\n  const [simulationResultsMycelium, setSimulationResultsMycelium] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [batchName, setBatchName] = useState('');\n  const [startDate, setStartDate] = useState(''); // Raw YYYY-MM-DD start date from localStorage\n  const [endDate, setEndDate] = useState('N/A'); // Formatted DD-MM-YYYY end date\n  const [finalSimulatedYield, setFinalSimulatedYield] = useState(null);\n  const [activeChartTab, setActiveChartTab] = useState('yield');\n  const [animationImageSrc, setAnimationImageSrc] = useState(null);\n\n  // State to store the specific parameters used for *this* simulation run (for saving)\n  const [simTemperature, setSimTemperature] = useState(null);\n  const [simPh, setSimPh] = useState(null);\n  const [simSubstrateJson, setSimSubstrateJson] = useState(null); // Store the raw JSON string\n  const [simDuration, setSimDuration] = useState(null);\n\n  // --- Local Storage Keys ---\n  const LOCAL_STORAGE_KEYS = {\n    TEMPERATURE: 'sim_temperature',\n    PH: 'sim_ph',\n    SUBSTRATE: 'sim_substrate',\n    SIMULATION_DAYS: 'sim_duration',\n    BATCH_NAME: 'sim_batch_name',\n    START_DATE: 'sim_start_date',\n    HISTORY: 'growthHistory' // Key for saving the history array\n  };\n\n  // --- Effect Hook to Run Simulations ---\n  useEffect(() => {\n    let isMounted = true;\n    // Reset states\n    setIsLoading(true);\n    setError(null);\n    setFinalSimulatedYield(null);\n    setSimulationResultsMushroom(null);\n    setSimulationResultsMycelium(null);\n    setEndDate('N/A');\n    setAnimationImageSrc(null);\n    setSimTemperature(null);\n    setSimPh(null);\n    setSimSubstrateJson(null);\n    setSimDuration(null);\n    const runSimulationsAsync = async () => {\n      await new Promise(resolve => setTimeout(resolve, 50));\n      if (!isMounted) return;\n      let savedTempStr, savedPhStr, savedSubstrateJsonStr, savedDaysStr, savedBatchNameStr, savedStartDateStr;\n      try {\n        // Load parameters from localStorage\n        savedTempStr = localStorage.getItem(LOCAL_STORAGE_KEYS.TEMPERATURE);\n        savedPhStr = localStorage.getItem(LOCAL_STORAGE_KEYS.PH);\n        savedSubstrateJsonStr = localStorage.getItem(LOCAL_STORAGE_KEYS.SUBSTRATE);\n        savedDaysStr = localStorage.getItem(LOCAL_STORAGE_KEYS.SIMULATION_DAYS);\n        savedBatchNameStr = localStorage.getItem(LOCAL_STORAGE_KEYS.BATCH_NAME) || 'N/A';\n        savedStartDateStr = localStorage.getItem(LOCAL_STORAGE_KEYS.START_DATE) || 'N/A'; // YYYY-MM-DD\n\n        if (isMounted) {\n          setBatchName(savedBatchNameStr);\n          setStartDate(savedStartDateStr); // Store raw start date\n        }\n\n        // Validate required parameters\n        const missingParams = [];\n        if (savedTempStr === null) missingParams.push('Temperature');\n        if (savedPhStr === null) missingParams.push('pH');\n        if (savedSubstrateJsonStr === null) missingParams.push('Substrate');\n        if (savedDaysStr === null) missingParams.push('Duration');\n        if (missingParams.length > 0) {\n          throw new Error(`Missing required parameters: ${missingParams.join(', ')}.`);\n        }\n\n        // Parse and validate numerical parameters\n        const temp = parseFloat(savedTempStr);\n        const phValue = parseFloat(savedPhStr);\n        const days = parseInt(savedDaysStr, 10);\n        let initialWeight = 0;\n        try {\n          const substrateData = JSON.parse(savedSubstrateJsonStr);\n          if (typeof substrateData !== 'object' || substrateData === null) throw new Error(\"Invalid substrate JSON.\");\n          initialWeight = Object.values(substrateData).reduce((sum, val) => sum + (Number(val) || 0), 0);\n          if (initialWeight <= 0) console.warn(\"Initial weight is zero/negative.\");\n        } catch (parseError) {\n          throw new Error(`Invalid substrate data: ${parseError.message}`);\n        }\n        if (isNaN(temp) || isNaN(phValue) || isNaN(initialWeight) || isNaN(days) || days < 0) {\n          throw new Error(\"Invalid numerical parameters.\");\n        }\n        const simulationDuration = days;\n\n        // --- Store parameters used for this run in state ---\n        if (isMounted) {\n          setSimTemperature(temp);\n          setSimPh(phValue);\n          setSimSubstrateJson(savedSubstrateJsonStr);\n          setSimDuration(simulationDuration);\n        }\n\n        // Calculate End Date (formatted DD-MM-YYYY)\n        const calculatedEndDate = calculateAndFormatEndDate(savedStartDateStr, simulationDuration);\n        if (isMounted) {\n          setEndDate(calculatedEndDate);\n        } // Store formatted end date\n\n        // Prepare inputs\n        const simulationInputs = {\n          'External Temp': temp,\n          'pH': phValue,\n          'Initial Dry Substrate Weight': initialWeight,\n          'timeLength': simulationDuration\n        };\n\n        // Run Simulations\n        const resultsMushroom = runSimulation(simulationInputs, defaultParamsMushroom);\n        const resultsMycelium = runSimulation(simulationInputs, defaultParamsMycelium);\n\n        // Update State with results\n        if (isMounted) {\n          setSimulationResultsMushroom(resultsMushroom);\n          setSimulationResultsMycelium(resultsMycelium);\n          if (resultsMushroom && resultsMushroom.length > 0) {\n            const lastMushroomResult = resultsMushroom[resultsMushroom.length - 1];\n            if (lastMushroomResult && Number.isFinite(lastMushroomResult.MushroomYield)) {\n              setFinalSimulatedYield(lastMushroomResult.MushroomYield);\n            } else {\n              setFinalSimulatedYield(null);\n            }\n          } else {\n            setFinalSimulatedYield(null);\n          }\n        }\n      } catch (err) {\n        console.error(\"Sim setup/run error:\", err);\n        if (isMounted) setError(err.message || \"Error occurred during simulation.\");\n      } finally {\n        if (isMounted) setIsLoading(false);\n      }\n    };\n    runSimulationsAsync();\n    return () => {\n      isMounted = false;\n    };\n  }, []);\n\n  // --- Event Handlers ---\n  const handleBackClick = () => navigate('/condition-setting');\n\n  /**\r\n   * Saves the current simulation results to localStorage and navigates to the landing page.\r\n   */\n  const handleDoneClick = () => {\n    console.log(\"Attempting to save simulation to history...\");\n\n    // Ensure necessary data is available before saving\n    // Check state variables holding the data for *this* run\n    if (simDuration === null || finalSimulatedYield === null || simSubstrateJson === null || simTemperature === null || simPh === null || startDate === null || endDate === null) {\n      console.error(\"Cannot save history: Simulation data is incomplete.\");\n      alert(\"Could not save simulation results. Data is missing.\");\n      return;\n    }\n\n    // 1. Format Conditions String\n    const conditionsString = `Temp: ${simTemperature}°C, pH: ${simPh.toFixed(1)}`;\n\n    // 2. Create New History Entry Object\n    const newHistoryEntry = {\n      id: Date.now(),\n      date: new Date().toLocaleDateString(),\n      // Date saved\n      startDate: startDate,\n      // Raw YYYY-MM-DD start date\n      endDate: endDate,\n      // Formatted DD-MM-YYYY end date\n      days: simDuration,\n      yield: finalSimulatedYield.toFixed(1),\n      // Save yield formatted\n      substrate: simSubstrateJson,\n      // Save the original JSON string\n      conditions: conditionsString,\n      batchName: batchName || 'N/A'\n    };\n    try {\n      // 3. Read Existing History\n      const existingHistoryString = localStorage.getItem(LOCAL_STORAGE_KEYS.HISTORY);\n      let history = [];\n      if (existingHistoryString) {\n        try {\n          history = JSON.parse(existingHistoryString);\n          if (!Array.isArray(history)) {\n            history = [];\n          }\n        } catch (parseError) {\n          console.error(\"Failed to parse existing history, starting fresh.\", parseError);\n          history = [];\n        }\n      }\n\n      // 4. Append New Entry\n      history.push(newHistoryEntry);\n\n      // 5. Write Updated History Back to localStorage\n      localStorage.setItem(LOCAL_STORAGE_KEYS.HISTORY, JSON.stringify(history));\n      console.log(\"Simulation saved to history:\", newHistoryEntry);\n\n      // 6. Navigate after successful save\n      navigate('/'); // Adjust route if needed\n    } catch (storageError) {\n      console.error(\"Error saving growth history to localStorage:\", storageError);\n      alert(\"Failed to save simulation history.\");\n      // Decide whether to navigate on failure\n      // navigate('/');\n    }\n  };\n\n  /**\r\n   * Handles clicks on chart points, displaying images based on time ranges.\r\n   * @param {object} event - The click event object.\r\n   */\n  const handleChartClick = event => {\n    const chart = chartRef.current;\n    if (!chart) {\n      console.warn(\"Chart instance not found.\");\n      return;\n    }\n    const elements = getElementAtEvent(chart, event);\n    if (elements.length > 0) {\n      const {\n        datasetIndex,\n        index\n      } = elements[0];\n      const dataset = chart.config.data.datasets[datasetIndex];\n      const dataPoint = dataset === null || dataset === void 0 ? void 0 : dataset.data[index];\n      if (dataPoint && activeChartTab === 'yield') {\n        const clickedTime = dataPoint.x;\n        // Check time ranges (inclusive start, exclusive end)\n        if (clickedTime >= 0 && clickedTime < 2) {\n          setAnimationImageSrc(asset1Src);\n        } else if (clickedTime >= 8 && clickedTime < 15) {\n          setAnimationImageSrc(day1Src);\n        } else if (clickedTime >= 35 && clickedTime < 40) {\n          setAnimationImageSrc(day5Src);\n        } else {\n          setAnimationImageSrc(null);\n        } // Clear for other points\n      } else {\n        setAnimationImageSrc(null);\n      } // Clear if not yield tab or invalid point\n    } else {/* setAnimationImageSrc(null); */} // Optional: clear on background click\n  };\n\n  // --- Chart Configuration Function ---\n  const getChartConfig = () => {\n    // ... (Chart config logic remains the same, including x-axis precision: 0) ...\n    const currentResultsSource = activeChartTab === 'mycelium' ? simulationResultsMycelium : simulationResultsMushroom;\n    const yieldColor = '#2E7D32';\n    const tempColor = '#C62828';\n    const myceliumColor = '#1976D2';\n    const textColor = '#333';\n    const gridColor = 'rgba(0, 0, 0, 0.08)';\n    const font = {\n      family: 'Lexend',\n      weight: '300'\n    };\n    const options = {\n      responsive: true,\n      maintainAspectRatio: false,\n      plugins: {\n        legend: {\n          display: true,\n          labels: {\n            color: textColor,\n            font: font\n          }\n        },\n        tooltip: {\n          enabled: true,\n          bodyFont: font,\n          titleFont: font\n        },\n        title: {\n          display: true,\n          text: '',\n          color: textColor,\n          font: {\n            ...font,\n            size: 16,\n            weight: '500'\n          }\n        }\n      },\n      scales: {\n        x: {\n          type: 'linear',\n          title: {\n            display: true,\n            text: 'Time (Days)',\n            color: textColor,\n            font: font\n          },\n          ticks: {\n            color: textColor,\n            font: font,\n            precision: 0\n          },\n          grid: {\n            color: gridColor\n          },\n          min: 0,\n          max: undefined\n        },\n        // x-axis precision is 0\n        yYield: {\n          type: 'linear',\n          position: 'left',\n          title: {\n            display: true,\n            text: 'Mushroom Yield (g)',\n            color: yieldColor,\n            font: font\n          },\n          ticks: {\n            color: yieldColor,\n            font: font\n          },\n          grid: {\n            drawOnChartArea: true,\n            color: gridColor\n          },\n          beginAtZero: true,\n          display: false\n        },\n        yTemp: {\n          type: 'linear',\n          position: 'left',\n          title: {\n            display: true,\n            text: 'Temperature (°C)',\n            color: tempColor,\n            font: font\n          },\n          ticks: {\n            color: tempColor,\n            font: font\n          },\n          grid: {\n            drawOnChartArea: false\n          },\n          display: false\n        },\n        yMycelium: {\n          type: 'linear',\n          position: 'left',\n          title: {\n            display: true,\n            text: 'Mycelium Density',\n            color: myceliumColor,\n            font: font\n          },\n          ticks: {\n            color: myceliumColor,\n            font: font,\n            callback: value => value.toFixed(2)\n          },\n          grid: {\n            drawOnChartArea: true,\n            color: gridColor\n          },\n          beginAtZero: true,\n          suggestedMax: 1,\n          display: false\n        }\n      },\n      interaction: {\n        mode: 'nearest',\n        axis: 'x',\n        intersect: false\n      }\n    };\n    options.scales.yYield.display = false;\n    options.scales.yTemp.display = false;\n    options.scales.yMycelium.display = false;\n    if (!currentResultsSource || currentResultsSource.length === 0) {\n      return {\n        data: {\n          datasets: []\n        },\n        options: options\n      };\n    }\n    let datasets = [];\n    let chartData = [...currentResultsSource];\n    let dataSourceName = '';\n    switch (activeChartTab) {\n      case 'yield':\n        dataSourceName = 'Mushroom Sim';\n        options.plugins.title.text = `Yield Over Time (${dataSourceName})`;\n        options.scales.yYield.display = true;\n        datasets = [{\n          label: 'Mushroom Yield (g)',\n          data: chartData.map(p => ({\n            x: p.time,\n            y: Number.isFinite(p.MushroomYield) ? p.MushroomYield : null\n          })),\n          borderColor: yieldColor,\n          backgroundColor: 'rgba(46, 125, 50, 0.1)',\n          yAxisID: 'yYield'\n        }];\n        options.scales.x.max = chartData.length > 0 ? chartData[chartData.length - 1].time : undefined;\n        break;\n      case 'temp':\n        dataSourceName = 'Mushroom Sim';\n        options.plugins.title.text = `Temperature Over Time (${dataSourceName})`;\n        options.scales.yTemp.display = true;\n        datasets = [{\n          label: 'Temperature (°C)',\n          data: chartData.map(p => ({\n            x: p.time,\n            y: Number.isFinite(p.Temp) ? p.Temp : null\n          })),\n          borderColor: tempColor,\n          backgroundColor: 'rgba(198, 40, 40, 0.1)',\n          yAxisID: 'yTemp'\n        }];\n        options.scales.x.max = chartData.length > 0 ? chartData[chartData.length - 1].time : undefined;\n        break;\n      case 'mycelium':\n        dataSourceName = 'Mycelium Sim';\n        options.plugins.title.text = `Mycelium Growth (${dataSourceName})`;\n        options.scales.yMycelium.display = true;\n        let cutoffIndex = chartData.findIndex(p => p.Mycelium >= 0.9);\n        let finalTime = chartData.length > 0 ? chartData[chartData.length - 1].time : 0;\n        let cutoffReason = \"Simulation End\";\n        if (cutoffIndex !== -1) {\n          chartData = chartData.slice(0, cutoffIndex + 1);\n          finalTime = chartData[chartData.length - 1].time;\n          cutoffReason = \"Mycelium >= 0.9\";\n        } else {\n          const day30Index = chartData.findIndex(p => p.time >= 30);\n          if (day30Index !== -1) {\n            chartData = chartData.slice(0, day30Index + 1);\n            finalTime = chartData[chartData.length - 1].time;\n            cutoffReason = \"Day 30 Limit\";\n          }\n        }\n        options.scales.x.max = finalTime;\n        if (cutoffReason !== \"Simulation End\") {\n          options.plugins.title.text += ` (Stopped at ${cutoffReason})`;\n        }\n        datasets = [{\n          label: 'Mycelium Density',\n          data: chartData.map(p => ({\n            x: p.time,\n            y: Number.isFinite(p.Mycelium) ? p.Mycelium : null\n          })),\n          borderColor: myceliumColor,\n          backgroundColor: 'rgba(25, 118, 210, 0.1)',\n          yAxisID: 'yMycelium'\n        }];\n        break;\n      default:\n        datasets = [];\n    }\n    const finalDatasets = datasets && datasets.length > 0 ? datasets.map(ds => {\n      var _ds$data, _ds$data2;\n      return {\n        ...ds,\n        tension: 0.1,\n        pointRadius: ((_ds$data = ds.data) === null || _ds$data === void 0 ? void 0 : _ds$data.length) > 150 ? 0.5 : ((_ds$data2 = ds.data) === null || _ds$data2 === void 0 ? void 0 : _ds$data2.length) > 50 ? 1 : 2,\n        pointHoverRadius: 4,\n        borderWidth: 1.5,\n        spanGaps: true\n      };\n    }).filter(ds => ds.data && ds.data.length > 0) : [];\n    return {\n      data: {\n        datasets: finalDatasets\n      },\n      options: options\n    };\n  };\n  // --- End getChartConfig function ---\n\n  // --- Render Logic ---\n  const chartConfig = getChartConfig();\n  const simulationDataReady = simulationResultsMushroom || simulationResultsMycelium;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"growth-simulation\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"simulation-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"logobox\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"logo\",\n          children: [\" \", /*#__PURE__*/_jsxDEV(\"img\", {\n            src: logoSrc,\n            alt: \"City Sprouts Logo\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 310,\n            columnNumber: 44\n          }, this), \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"batch-info\",\n        children: [\" \", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"batch-name\",\n          children: [\"Batch: \", batchName]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 46\n        }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"start-date\",\n          children: [\"Start: \", formatDate_DDMMYYYY(startDate)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 101\n        }, this), \" \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"main-content-grid\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"animation-area content-card\",\n        children: animationImageSrc ? /*#__PURE__*/_jsxDEV(\"img\", {\n          src: animationImageSrc,\n          alt: \"Simulation state representation\",\n          style: {\n            maxWidth: '100%',\n            maxHeight: '100%',\n            objectFit: 'contain',\n            display: 'block',\n            margin: 'auto'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 44\n        }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Animation / Visualization Area\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 224\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chart-results-column\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tabs-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              setActiveChartTab('yield');\n              setAnimationImageSrc(null);\n            },\n            className: `tab-button ${activeChartTab === 'yield' ? 'tab-button-active' : ''}`,\n            children: \" Yield \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 26\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              setActiveChartTab('temp');\n              setAnimationImageSrc(null);\n            },\n            className: `tab-button ${activeChartTab === 'temp' ? 'tab-button-active' : ''}`,\n            children: \" Temperature \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 26\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              setActiveChartTab('mycelium');\n              setAnimationImageSrc(null);\n            },\n            className: `tab-button ${activeChartTab === 'mycelium' ? 'tab-button-active' : ''}`,\n            children: \" Mycelium \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 26\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chart-area content-card\",\n          children: [isLoading && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"loading-message\",\n            children: \"Running simulations...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 333,\n            columnNumber: 39\n          }, this), error && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"error-message\",\n            children: [\"Error: \", error]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 35\n          }, this), !isLoading && !error && simulationDataReady && (chartConfig.data.datasets.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chart-container\",\n            children: [\" \", /*#__PURE__*/_jsxDEV(Line, {\n              ref: chartRef,\n              options: chartConfig.options,\n              data: chartConfig.data,\n              onClick: handleChartClick\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 335,\n              columnNumber: 150\n            }, this), \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 116\n          }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"no-data-message\",\n            children: [\"No simulation data to display for the '\", activeChartTab, \"' chart.\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 268\n          }, this)), !isLoading && !error && !simulationDataReady && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"no-data-message\",\n            children: \"Simulation results not available.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 74\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"results-section content-card\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"results-heading\",\n            children: [\" Simulation Results \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"info-icon\",\n              title: \"Projected yield is based on the Mushroom phase simulation. End date calculated from start date and duration.\",\n              children: \"i\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 341,\n              columnNumber: 77\n            }, this), \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 341,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"results-items\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"result-item\",\n              children: [\" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"result-label\",\n                children: \"Projected Yield:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 343,\n                columnNumber: 59\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"result-value\",\n                children: [\" \", isLoading ? '...' : error ? 'Error' : finalSimulatedYield !== null && Number.isFinite(finalSimulatedYield) ? `${finalSimulatedYield.toFixed(1)}g` : 'N/A', \" \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 343,\n                columnNumber: 114\n              }, this), \" \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 343,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"result-item\",\n              children: [\" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"result-label\",\n                children: \"Projected End Date:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 344,\n                columnNumber: 59\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"result-value\",\n                children: [\" \", isLoading ? '...' : error ? 'Error' : endDate, \" \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 344,\n                columnNumber: 117\n              }, this), \" \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 344,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 342,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleDoneClick,\n      className: \"done-button\",\n      title: \"Save and Go to Landing Page\",\n      children: \"Done\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 306,\n    columnNumber: 9\n  }, this);\n};\n_s(GrowthSimulation, \"skQ7ckLbyRizRsWaD9vsyu8RFPQ=\", false, function () {\n  return [useNavigate];\n});\n_c = GrowthSimulation;\nexport default GrowthSimulation;\nvar _c;\n$RefreshReg$(_c, \"GrowthSimulation\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","Line","Chart","ChartJS","LineElement","PointElement","Tooltip","Legend","CategoryScale","LinearScale","Title","Interaction","getElementAtEvent","odeRK4","logoSrc","asset1Src","day1Src","day5Src","jsxDEV","_jsxDEV","register","defaultParamsMushroom","timeStart","timeLength","timeStep","defaultParamsMycelium","FIXED_CN_RATIO","linearInterpolate","data","x","length","i","x0","y0","x1","y1","divisor","t","derivatives","dydt","y","currentParams","currentCO2","currentComplexC","currentMushroomYield","currentMycelium","currentN","currentSimpleC","currentSpace","currentTemp","initialDrySubstrateWeight","cnRatio","cnRatioPlusOne","InitC","AvailableN","AvailableC","VolumeNormalisation","Math","sqrt","Effect_of_CO2_on_Mush_Growth","Effect_of_CO2_on_Myc_Growth","Effect_of_pH_on_Mush_Growth","Effect_of_pH_on_Myc_Growth","Effect_of_Temp_on_Mush_Growth","Effect_of_Temp_on_Myc_Growth","isMushPhase","TempEff_","TempEffect","pHEff_","pHEffect","CO2Eff_","CO2Effect","NEffect","CEffect","max","safeTempEffect","safePhEffect","safeNEffect","safeCEffect","safeCO2Effect","RawGrowthRate","GrowthOpp","GrowthRate","NormGrowthRate","flow_Breakdown","flow_CCons","flow_CO2Prod","flow_CO2Vent","flow_Colonisation","flow_MushroomGrowth","flow_NCons","flow_TempProd","flow_TempVent","epsilon","getInitialState","p","initialMyceliumValue","Number","complexSimpleRatio","isNaN","console","error","Init_N","Init_C","initialSpace","runSimulation","inputParams","defaultParamSet","_currentParams$Initia","_currentParams$Initia2","finalInitialWeight","finalCNRatio","finalComplexSimpleRatio","finalExternalCO2","finalExternalTemp","initialStateParams","t0","dt","positiveDt","numSteps","floor","derivativeFuncForSolver","e","fill","integrator","results","time","state","simType","warn","step","some","val","isFinite","toFixed","push","solverError","map","CO2","ComplexC","MushroomYield","Mycelium","N","SimpleC","Space","Temp","formatDate_DDMMYYYY","dateString","test","year","month","day","split","calculateAndFormatEndDate","startDateStr","durationDays","startDateObj","Date","endDateObj","getTime","setDate","getDate","endYear","getFullYear","endMonth","String","getMonth","padStart","endDay","endDateStrYYYYMMDD","dateError","GrowthSimulation","_s","navigate","chartRef","simulationResultsMushroom","setSimulationResultsMushroom","simulationResultsMycelium","setSimulationResultsMycelium","isLoading","setIsLoading","setError","batchName","setBatchName","startDate","setStartDate","endDate","setEndDate","finalSimulatedYield","setFinalSimulatedYield","activeChartTab","setActiveChartTab","animationImageSrc","setAnimationImageSrc","simTemperature","setSimTemperature","simPh","setSimPh","simSubstrateJson","setSimSubstrateJson","simDuration","setSimDuration","LOCAL_STORAGE_KEYS","TEMPERATURE","PH","SUBSTRATE","SIMULATION_DAYS","BATCH_NAME","START_DATE","HISTORY","isMounted","runSimulationsAsync","Promise","resolve","setTimeout","savedTempStr","savedPhStr","savedSubstrateJsonStr","savedDaysStr","savedBatchNameStr","savedStartDateStr","localStorage","getItem","missingParams","Error","join","temp","parseFloat","phValue","days","parseInt","initialWeight","substrateData","JSON","parse","Object","values","reduce","sum","parseError","message","simulationDuration","calculatedEndDate","simulationInputs","resultsMushroom","resultsMycelium","lastMushroomResult","err","handleBackClick","handleDoneClick","log","alert","conditionsString","newHistoryEntry","id","now","date","toLocaleDateString","yield","substrate","conditions","existingHistoryString","history","Array","isArray","setItem","stringify","storageError","handleChartClick","event","chart","current","elements","datasetIndex","index","dataset","config","datasets","dataPoint","clickedTime","getChartConfig","currentResultsSource","yieldColor","tempColor","myceliumColor","textColor","gridColor","font","family","weight","options","responsive","maintainAspectRatio","plugins","legend","display","labels","color","tooltip","enabled","bodyFont","titleFont","title","text","size","scales","type","ticks","precision","grid","min","undefined","yYield","position","drawOnChartArea","beginAtZero","yTemp","yMycelium","callback","value","suggestedMax","interaction","mode","axis","intersect","chartData","dataSourceName","label","borderColor","backgroundColor","yAxisID","cutoffIndex","findIndex","finalTime","cutoffReason","slice","day30Index","finalDatasets","ds","_ds$data","_ds$data2","tension","pointRadius","pointHoverRadius","borderWidth","spanGaps","filter","chartConfig","simulationDataReady","className","children","src","alt","fileName","_jsxFileName","lineNumber","columnNumber","style","maxWidth","maxHeight","objectFit","margin","onClick","ref","_c","$RefreshReg$"],"sources":["C:/Users/celst/sds/src/components/GrowthSimulation.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Line } from 'react-chartjs-2';\r\nimport {\r\n    Chart as ChartJS,\r\n    LineElement,\r\n    PointElement,\r\n    Tooltip,\r\n    Legend,\r\n    CategoryScale,\r\n    LinearScale,\r\n    Title,\r\n    Interaction\r\n} from 'chart.js';\r\nimport { getElementAtEvent } from 'react-chartjs-2';\r\nimport odeRK4 from 'ode-rk4';\r\n\r\n// --- CSS and Asset Imports ---\r\n// Adjust these paths according to your project structure\r\nimport '../styles/GrowthSimulation.css';\r\nimport logoSrc from '../assets/images/cslogo.png';\r\nimport asset1Src from '../assets/images/my100.jpg'; // Image for Day 0-2 click\r\nimport day1Src from '../assets/images/Day1.jpg';   // Image for Day 8-15 click\r\nimport day5Src from '../assets/images/Day5.jpg';   // Image for Day 35-40 click\r\n\r\n// --- Simulation Logic & ChartJS Registration ---\r\nChartJS.register(LineElement, PointElement, Tooltip, Legend, CategoryScale, LinearScale, Title);\r\n\r\n// *** Default Parameters & Simulation Functions ***\r\n// (Assume defaultParamsMushroom, defaultParamsMycelium, FIXED_CN_RATIO,\r\n// linearInterpolate, derivatives, getInitialState, runSimulation are unchanged)\r\n// *** Default Parameters for MUSHROOM Growth ***\r\nconst defaultParamsMushroom = {\r\n    timeStart: 0, timeLength: 100, timeStep: 0.2, 'C BD Rate': 1.11, 'C Coeff': 0.7, 'C Cons. Rate': 76.39, 'CO2 Coeff': 0.8, 'CO2 Production Rate': 410000, 'CO2 Removal Rate': 12.6, 'External CO2': 428.23, 'External Temp': 24, 'Growth Coeff': 5.1, 'Initial Complex:Simple Ratio': 0.8054, 'Initial Dry Substrate Weight': 410.2, 'IsMush': 1, 'Mushroom Multiplier': 5.17, 'N Coeff': 68.4, 'N Rate': 13.03, 'pH': 6.91, 'pH Coeff': 1.4, 'Temp Coeff': 1.3, 'Temp Production Rate': 405, 'Temp Transfer Rate': 1.5, 'Effect of CO2 on Mush Growth Data': [[500, 0.9], [800, 1], [1000, 0.8], [1200, 0.25], [1400, 0]], 'Effect of CO2 on Myc Growth Data': [[15000, 1], [20000, 0.9], [25000, 0.25], [30000, 0]], 'Effect of pH on Mush Growth Data': [[5.5, 0], [6, 0.25], [6.7, 1], [7, 0.6], [7.5, 0]], 'Effect of pH on Myc Growth Data': [[5.8, 0], [6, 0.25], [6.7, 1], [7, 0.6], [7.5, 0]], 'Effect of Temp on Mush Growth Data': [[10, 0], [15, 5.37], [20, 6.36], [25, 8.63], [30, 6.37], [40, 0]], 'Effect of Temp on Myc Growth Data': [[10, 0], [15, 5.37], [20, 6.36], [25, 8.63], [30, 6.37], [35, 5.36], [45, 0]], 'Initial Mycelium': 0.9,\r\n};\r\n// *** Default Parameters for MYCELIUM Growth ***\r\nconst defaultParamsMycelium = {\r\n    timeStart: 0, timeLength: 100, timeStep: 0.2, 'C BD Rate': 1.11, 'C Coeff': 0.7, 'C Cons. Rate': 76.39, 'CO2 Coeff': 0.8, 'CO2 Production Rate': 410000, 'CO2 Removal Rate': 1, 'External CO2': 428.23, 'External Temp': 28, 'Growth Coeff': 5.4, 'Initial Complex:Simple Ratio': 0.867, 'Initial Dry Substrate Weight': 200, 'IsMush': 0, 'Mushroom Multiplier': 26, 'N Coeff': 68.4, 'N Rate': 1.53, 'pH': 6.91, 'pH Coeff': 1.4, 'Temp Coeff': 1.7, 'Temp Production Rate': 255, 'Temp Transfer Rate': 1.5, 'Effect of CO2 on Mush Growth Data': [[500, 0.9], [800, 1], [1000, 0.8], [1200, 0.25], [1400, 0]], 'Effect of CO2 on Myc Growth Data': [[15000, 1], [20000, 0.9], [25000, 0.25], [30000, 0]], 'Effect of pH on Mush Growth Data': [[5.5, 0], [6, 0.25], [6.7, 1], [7, 0.6], [7.5, 0]], 'Effect of pH on Myc Growth Data': [[5.8, 0], [6, 0.25], [6.7, 1], [7, 0.6], [7.5, 0]], 'Effect of Temp on Mush Growth Data': [[10, 0], [15, 5.37], [20, 6.36], [25, 8.63], [30, 6.37], [40, 0]], 'Effect of Temp on Myc Growth Data': [[10, 0], [15, 5.37], [20, 6.36], [25, 8.63], [30, 6.37], [35, 5.36], [45, 0]], 'Initial Mycelium': 0.004,\r\n};\r\n// FIXED C:N Ratio\r\nconst FIXED_CN_RATIO = 0.96;\r\n// --- Simulation Functions ---\r\nfunction linearInterpolate(data, x) { if (!data || data.length === 0) return 0; if (x <= data[0][0]) return data[0][1]; if (x >= data[data.length - 1][0]) return data[data.length - 1][1]; let i = 0; while (i < data.length - 1 && x > data[i + 1][0]) i++; const x0 = data[i][0], y0 = data[i][1]; const x1 = data[i + 1][0], y1 = data[i + 1][1]; const divisor = (x1 - x0); if (divisor === 0) return y0; const t = (x - x0) / divisor; return y0 + t * (y1 - y0); }\r\nfunction derivatives(dydt, y, t, currentParams) { const [ currentCO2, currentComplexC, currentMushroomYield, currentMycelium, currentN, currentSimpleC, currentSpace, currentTemp ] = y; const initialDrySubstrateWeight = currentParams['Initial Dry Substrate Weight'] || 1; const cnRatio = currentParams['Initial C:N Ratio']; const cnRatioPlusOne = cnRatio + 1; const InitC = initialDrySubstrateWeight - (initialDrySubstrateWeight / cnRatioPlusOne); const AvailableN = initialDrySubstrateWeight > 0 ? currentN / initialDrySubstrateWeight : 0; const AvailableC = initialDrySubstrateWeight > 0 ? currentSimpleC / initialDrySubstrateWeight : 0; const VolumeNormalisation = initialDrySubstrateWeight > 0 ? Math.sqrt(100 / initialDrySubstrateWeight) : Math.sqrt(100); const Effect_of_CO2_on_Mush_Growth = linearInterpolate(currentParams['Effect of CO2 on Mush Growth Data'], currentCO2); const Effect_of_CO2_on_Myc_Growth = linearInterpolate(currentParams['Effect of CO2 on Myc Growth Data'], currentCO2); const Effect_of_pH_on_Mush_Growth = linearInterpolate(currentParams['Effect of pH on Mush Growth Data'], currentParams['pH']); const Effect_of_pH_on_Myc_Growth = linearInterpolate(currentParams['Effect of pH on Myc Growth Data'], currentParams['pH']); const Effect_of_Temp_on_Mush_Growth = linearInterpolate(currentParams['Effect of Temp on Mush Growth Data'], currentTemp); const Effect_of_Temp_on_Myc_Growth = linearInterpolate(currentParams['Effect of Temp on Myc Growth Data'], currentTemp); const isMushPhase = currentParams['IsMush'] === 1; const TempEff_ = isMushPhase ? Effect_of_Temp_on_Mush_Growth : Effect_of_Temp_on_Myc_Growth; const TempEffect = (currentParams['Temp Coeff'] * TempEff_) / 10; const pHEff_ = isMushPhase ? Effect_of_pH_on_Mush_Growth : Effect_of_pH_on_Myc_Growth; const pHEffect = pHEff_ * currentParams['pH Coeff']; const CO2Eff_ = isMushPhase ? Effect_of_CO2_on_Mush_Growth : Effect_of_CO2_on_Myc_Growth; const CO2Effect = currentParams['CO2 Coeff'] * CO2Eff_; const NEffect = currentParams['N Coeff'] * AvailableN; const CEffect = Math.sqrt(Math.max(0, currentParams['C Coeff'] * AvailableC)); const safeTempEffect = Math.max(0, TempEffect); const safePhEffect = Math.max(0, pHEffect); const safeNEffect = Math.max(0, NEffect); const safeCEffect = Math.max(0, CEffect); const safeCO2Effect = Math.max(0, CO2Effect); const RawGrowthRate = safeTempEffect * safePhEffect * safeNEffect * safeCEffect * safeCO2Effect; const GrowthOpp = currentSpace * currentMycelium; let GrowthRate = isMushPhase ? (RawGrowthRate * currentParams['Growth Coeff']) : (RawGrowthRate * GrowthOpp * currentParams['Growth Coeff']); GrowthRate = Math.max(0, GrowthRate); let NormGrowthRate = isMushPhase ? (GrowthRate / 100) : GrowthRate; NormGrowthRate = Math.max(0, NormGrowthRate); const flow_Breakdown = Math.max(0, currentMycelium * currentParams['C BD Rate'] * currentComplexC * RawGrowthRate * VolumeNormalisation); const flow_CCons = Math.max(0, NormGrowthRate * currentParams['C Cons. Rate']); const flow_CO2Prod = Math.max(0, NormGrowthRate * currentParams['CO2 Production Rate']); const flow_CO2Vent = Math.max(0, currentParams['CO2 Removal Rate'] * (currentCO2 - currentParams['External CO2']) * VolumeNormalisation); const flow_Colonisation = isMushPhase ? 0 : GrowthRate; const flow_MushroomGrowth = isMushPhase ? Math.max(0, GrowthRate * currentParams['Mushroom Multiplier']) : 0; const flow_NCons = Math.max(0, NormGrowthRate * currentParams['N Rate']); const flow_TempProd = Math.max(0, NormGrowthRate * currentParams['Temp Production Rate']); const flow_TempVent = Math.max(0, (currentTemp - currentParams['External Temp']) * currentParams['Temp Transfer Rate'] * VolumeNormalisation); dydt[0] = flow_CO2Prod - flow_CO2Vent; dydt[1] = -flow_Breakdown; dydt[2] = flow_MushroomGrowth; dydt[3] = flow_Colonisation; dydt[4] = -flow_NCons; dydt[5] = flow_Breakdown - flow_CCons; dydt[6] = -flow_Colonisation; dydt[7] = flow_TempProd - flow_TempVent; const epsilon = 1e-9; if (y[0] <= epsilon && dydt[0] < 0) dydt[0] = 0; if (y[1] <= epsilon && dydt[1] < 0) dydt[1] = 0; if (y[2] <= epsilon && dydt[2] < 0) dydt[2] = 0; if (y[3] <= epsilon && dydt[3] < 0) dydt[3] = 0; if (y[4] <= epsilon && dydt[4] < 0) dydt[4] = 0; if (y[5] <= epsilon && dydt[5] < 0) dydt[5] = 0; if (y[6] <= epsilon && dydt[6] < 0) dydt[6] = 0; }\r\nfunction getInitialState(p, initialMyceliumValue) { const initialDrySubstrateWeight = Number(p['Initial Dry Substrate Weight']); const cnRatio = Number(p['Initial C:N Ratio']); const complexSimpleRatio = Number(p['Initial Complex:Simple Ratio']); if (isNaN(initialDrySubstrateWeight) || initialDrySubstrateWeight <= 0 || isNaN(cnRatio) || cnRatio <= 0 || isNaN(complexSimpleRatio) || complexSimpleRatio < 0 || complexSimpleRatio > 1) { console.error(\"Invalid parameters for getInitialState:\", p); return [400, 200, 0, 0.01, 10, 50, 0.99, 25]; } const cnRatioPlusOne = cnRatio + 1; const Init_N = initialDrySubstrateWeight / cnRatioPlusOne; const Init_C = initialDrySubstrateWeight - Init_N; const initialSpace = Math.max(0, 1 - initialMyceliumValue); return [ Number(p['External CO2']), Init_C * complexSimpleRatio, 0, initialMyceliumValue, Init_N, Init_C * (1 - complexSimpleRatio), initialSpace, Number(p['External Temp']) ]; }\r\nfunction runSimulation(inputParams, defaultParamSet) { if (!defaultParamSet) { console.error(\"runSimulation called without defaultParamSet!\"); return []; } const currentParams = { ...defaultParamSet, ...inputParams, 'Initial C:N Ratio': FIXED_CN_RATIO, }; const finalInitialWeight = Number(currentParams['Initial Dry Substrate Weight']); const finalCNRatio = Number(currentParams['Initial C:N Ratio']); const finalComplexSimpleRatio = Number(currentParams['Initial Complex:Simple Ratio']); const finalExternalCO2 = Number(currentParams['External CO2']); const finalExternalTemp = Number(currentParams['External Temp']); const initialMyceliumValue = currentParams['IsMush'] === 0 ? (currentParams['Initial Mycelium'] ?? defaultParamsMycelium['Initial Mycelium']) : (currentParams['Initial Mycelium'] ?? defaultParamsMushroom['Initial Mycelium']); const initialStateParams = { 'Initial Dry Substrate Weight': finalInitialWeight, 'Initial C:N Ratio': finalCNRatio, 'Initial Complex:Simple Ratio': finalComplexSimpleRatio, 'External CO2': finalExternalCO2, 'External Temp': finalExternalTemp, }; const y0 = getInitialState(initialStateParams, initialMyceliumValue); const t0 = currentParams.timeStart; const dt = currentParams.timeStep; const timeLength = Math.max(0, Number(currentParams.timeLength)); const positiveDt = Math.max(dt, 1e-6); const numSteps = timeLength > 0 && positiveDt > 0 ? Math.floor(timeLength / positiveDt) : 0; const derivativeFuncForSolver = (dydt, y, t) => { try { derivatives(dydt, y, t, currentParams); } catch (e) { console.error(\"Error inside derivatives function:\", e); dydt.fill(0); } }; const integrator = odeRK4(y0, derivativeFuncForSolver, t0, positiveDt); const results = [{ time: integrator.t, state: [...integrator.y] }]; const simType = currentParams['IsMush'] === 0 ? 'Mycelium' : 'Mushroom'; if (numSteps <= 0) { console.warn(`${simType} Sim: 0 steps. Simulation not run.`); return []; } for (let i = 0; i < numSteps; i++) { try { integrator.step(); if (integrator.y.some(val => !Number.isFinite(val))) { console.error(`${simType} Sim: Non-finite value at t=${integrator.t.toFixed(2)}. State:`, integrator.y); } results.push({ time: integrator.t, state: [...integrator.y] }); } catch (solverError) { console.error(`${simType} Sim: Solver error at t=${integrator.t.toFixed(2)}:`, solverError); break; } } return results.map(p => ({ time: p.time, CO2: p.state[0], ComplexC: p.state[1], MushroomYield: p.state[2], Mycelium: p.state[3], N: p.state[4], SimpleC: p.state[5], Space: p.state[6], Temp: p.state[7] })); }\r\n// --- (End of Simulation Functions) ---\r\n\r\n\r\n// --- Helper Functions ---\r\nfunction formatDate_DDMMYYYY(dateString) { if (!dateString || dateString === 'N/A' || !/^\\d{4}-\\d{2}-\\d{2}$/.test(dateString)) { return 'N/A'; } try { const [year, month, day] = dateString.split('-'); return `${day}-${month}-${year}`; } catch (e) { console.error(\"Error formatting date:\", e); return 'N/A'; } }\r\nfunction calculateAndFormatEndDate(startDateStr, durationDays) { if (!startDateStr || startDateStr === 'N/A' || !/^\\d{4}-\\d{2}-\\d{2}$/.test(startDateStr) || isNaN(durationDays) || durationDays < 0) { return 'N/A'; } try { const startDateObj = new Date(startDateStr); const endDateObj = new Date(startDateObj.getTime()); endDateObj.setDate(endDateObj.getDate() + durationDays); const endYear = endDateObj.getFullYear(); const endMonth = String(endDateObj.getMonth() + 1).padStart(2, '0'); const endDay = String(endDateObj.getDate()).padStart(2, '0'); const endDateStrYYYYMMDD = `${endYear}-${endMonth}-${endDay}`; return formatDate_DDMMYYYY(endDateStrYYYYMMDD); } catch (dateError) { console.error(\"Error calculating end date:\", dateError); return 'N/A'; } }\r\n\r\n\r\n// --- React Component Definition ---\r\nconst GrowthSimulation = () => {\r\n    const navigate = useNavigate();\r\n    const chartRef = useRef(null);\r\n\r\n    // --- State Variables ---\r\n    // Simulation results and UI state\r\n    const [simulationResultsMushroom, setSimulationResultsMushroom] = useState(null);\r\n    const [simulationResultsMycelium, setSimulationResultsMycelium] = useState(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n    const [batchName, setBatchName] = useState('');\r\n    const [startDate, setStartDate] = useState(''); // Raw YYYY-MM-DD start date from localStorage\r\n    const [endDate, setEndDate] = useState('N/A'); // Formatted DD-MM-YYYY end date\r\n    const [finalSimulatedYield, setFinalSimulatedYield] = useState(null);\r\n    const [activeChartTab, setActiveChartTab] = useState('yield');\r\n    const [animationImageSrc, setAnimationImageSrc] = useState(null);\r\n\r\n    // State to store the specific parameters used for *this* simulation run (for saving)\r\n    const [simTemperature, setSimTemperature] = useState(null);\r\n    const [simPh, setSimPh] = useState(null);\r\n    const [simSubstrateJson, setSimSubstrateJson] = useState(null); // Store the raw JSON string\r\n    const [simDuration, setSimDuration] = useState(null);\r\n\r\n    // --- Local Storage Keys ---\r\n    const LOCAL_STORAGE_KEYS = {\r\n        TEMPERATURE: 'sim_temperature', PH: 'sim_ph', SUBSTRATE: 'sim_substrate',\r\n        SIMULATION_DAYS: 'sim_duration', BATCH_NAME: 'sim_batch_name', START_DATE: 'sim_start_date',\r\n        HISTORY: 'growthHistory' // Key for saving the history array\r\n    };\r\n\r\n    // --- Effect Hook to Run Simulations ---\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n        // Reset states\r\n        setIsLoading(true); setError(null); setFinalSimulatedYield(null);\r\n        setSimulationResultsMushroom(null); setSimulationResultsMycelium(null);\r\n        setEndDate('N/A'); setAnimationImageSrc(null);\r\n        setSimTemperature(null); setSimPh(null); setSimSubstrateJson(null); setSimDuration(null);\r\n\r\n        const runSimulationsAsync = async () => {\r\n            await new Promise(resolve => setTimeout(resolve, 50));\r\n            if (!isMounted) return;\r\n\r\n            let savedTempStr, savedPhStr, savedSubstrateJsonStr, savedDaysStr, savedBatchNameStr, savedStartDateStr;\r\n            try {\r\n                // Load parameters from localStorage\r\n                savedTempStr = localStorage.getItem(LOCAL_STORAGE_KEYS.TEMPERATURE);\r\n                savedPhStr = localStorage.getItem(LOCAL_STORAGE_KEYS.PH);\r\n                savedSubstrateJsonStr = localStorage.getItem(LOCAL_STORAGE_KEYS.SUBSTRATE);\r\n                savedDaysStr = localStorage.getItem(LOCAL_STORAGE_KEYS.SIMULATION_DAYS);\r\n                savedBatchNameStr = localStorage.getItem(LOCAL_STORAGE_KEYS.BATCH_NAME) || 'N/A';\r\n                savedStartDateStr = localStorage.getItem(LOCAL_STORAGE_KEYS.START_DATE) || 'N/A'; // YYYY-MM-DD\r\n\r\n                if (isMounted) {\r\n                    setBatchName(savedBatchNameStr);\r\n                    setStartDate(savedStartDateStr); // Store raw start date\r\n                }\r\n\r\n                // Validate required parameters\r\n                const missingParams = [];\r\n                if (savedTempStr === null) missingParams.push('Temperature');\r\n                if (savedPhStr === null) missingParams.push('pH');\r\n                if (savedSubstrateJsonStr === null) missingParams.push('Substrate');\r\n                if (savedDaysStr === null) missingParams.push('Duration');\r\n                if (missingParams.length > 0) { throw new Error(`Missing required parameters: ${missingParams.join(', ')}.`); }\r\n\r\n                // Parse and validate numerical parameters\r\n                const temp = parseFloat(savedTempStr);\r\n                const phValue = parseFloat(savedPhStr);\r\n                const days = parseInt(savedDaysStr, 10);\r\n                let initialWeight = 0;\r\n                try {\r\n                    const substrateData = JSON.parse(savedSubstrateJsonStr);\r\n                    if (typeof substrateData !== 'object' || substrateData === null) throw new Error(\"Invalid substrate JSON.\");\r\n                    initialWeight = Object.values(substrateData).reduce((sum, val) => sum + (Number(val) || 0), 0);\r\n                    if (initialWeight <= 0) console.warn(\"Initial weight is zero/negative.\");\r\n                } catch (parseError) { throw new Error(`Invalid substrate data: ${parseError.message}`); }\r\n                if (isNaN(temp) || isNaN(phValue) || isNaN(initialWeight) || isNaN(days) || days < 0) { throw new Error(\"Invalid numerical parameters.\"); }\r\n\r\n                const simulationDuration = days;\r\n\r\n                // --- Store parameters used for this run in state ---\r\n                if (isMounted) {\r\n                    setSimTemperature(temp);\r\n                    setSimPh(phValue);\r\n                    setSimSubstrateJson(savedSubstrateJsonStr);\r\n                    setSimDuration(simulationDuration);\r\n                }\r\n\r\n                // Calculate End Date (formatted DD-MM-YYYY)\r\n                const calculatedEndDate = calculateAndFormatEndDate(savedStartDateStr, simulationDuration);\r\n                if (isMounted) { setEndDate(calculatedEndDate); } // Store formatted end date\r\n\r\n                // Prepare inputs\r\n                const simulationInputs = { 'External Temp': temp, 'pH': phValue, 'Initial Dry Substrate Weight': initialWeight, 'timeLength': simulationDuration, };\r\n\r\n                // Run Simulations\r\n                const resultsMushroom = runSimulation(simulationInputs, defaultParamsMushroom);\r\n                const resultsMycelium = runSimulation(simulationInputs, defaultParamsMycelium);\r\n\r\n                // Update State with results\r\n                if (isMounted) {\r\n                    setSimulationResultsMushroom(resultsMushroom);\r\n                    setSimulationResultsMycelium(resultsMycelium);\r\n                    if (resultsMushroom && resultsMushroom.length > 0) {\r\n                        const lastMushroomResult = resultsMushroom[resultsMushroom.length - 1];\r\n                        if (lastMushroomResult && Number.isFinite(lastMushroomResult.MushroomYield)) {\r\n                            setFinalSimulatedYield(lastMushroomResult.MushroomYield);\r\n                        } else { setFinalSimulatedYield(null); }\r\n                    } else { setFinalSimulatedYield(null); }\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Sim setup/run error:\", err);\r\n                if (isMounted) setError(err.message || \"Error occurred during simulation.\");\r\n            } finally {\r\n                if (isMounted) setIsLoading(false);\r\n            }\r\n        };\r\n        runSimulationsAsync();\r\n        return () => { isMounted = false; };\r\n    }, []);\r\n\r\n    // --- Event Handlers ---\r\n    const handleBackClick = () => navigate('/condition-setting');\r\n\r\n    /**\r\n     * Saves the current simulation results to localStorage and navigates to the landing page.\r\n     */\r\n    const handleDoneClick = () => {\r\n        console.log(\"Attempting to save simulation to history...\");\r\n\r\n        // Ensure necessary data is available before saving\r\n        // Check state variables holding the data for *this* run\r\n        if (simDuration === null || finalSimulatedYield === null || simSubstrateJson === null || simTemperature === null || simPh === null || startDate === null || endDate === null) {\r\n            console.error(\"Cannot save history: Simulation data is incomplete.\");\r\n            alert(\"Could not save simulation results. Data is missing.\");\r\n            return;\r\n        }\r\n\r\n        // 1. Format Conditions String\r\n        const conditionsString = `Temp: ${simTemperature}°C, pH: ${simPh.toFixed(1)}`;\r\n\r\n        // 2. Create New History Entry Object\r\n        const newHistoryEntry = {\r\n            id: Date.now(),\r\n            date: new Date().toLocaleDateString(), // Date saved\r\n            startDate: startDate, // Raw YYYY-MM-DD start date\r\n            endDate: endDate,     // Formatted DD-MM-YYYY end date\r\n            days: simDuration,\r\n            yield: finalSimulatedYield.toFixed(1), // Save yield formatted\r\n            substrate: simSubstrateJson, // Save the original JSON string\r\n            conditions: conditionsString,\r\n            batchName: batchName || 'N/A',\r\n        };\r\n\r\n        try {\r\n            // 3. Read Existing History\r\n            const existingHistoryString = localStorage.getItem(LOCAL_STORAGE_KEYS.HISTORY);\r\n            let history = [];\r\n            if (existingHistoryString) {\r\n                try {\r\n                    history = JSON.parse(existingHistoryString);\r\n                    if (!Array.isArray(history)) { history = []; }\r\n                } catch (parseError) {\r\n                    console.error(\"Failed to parse existing history, starting fresh.\", parseError);\r\n                    history = [];\r\n                }\r\n            }\r\n\r\n            // 4. Append New Entry\r\n            history.push(newHistoryEntry);\r\n\r\n            // 5. Write Updated History Back to localStorage\r\n            localStorage.setItem(LOCAL_STORAGE_KEYS.HISTORY, JSON.stringify(history));\r\n            console.log(\"Simulation saved to history:\", newHistoryEntry);\r\n\r\n            // 6. Navigate after successful save\r\n            navigate('/'); // Adjust route if needed\r\n\r\n        } catch (storageError) {\r\n            console.error(\"Error saving growth history to localStorage:\", storageError);\r\n            alert(\"Failed to save simulation history.\");\r\n            // Decide whether to navigate on failure\r\n            // navigate('/');\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Handles clicks on chart points, displaying images based on time ranges.\r\n     * @param {object} event - The click event object.\r\n     */\r\n    const handleChartClick = (event) => {\r\n        const chart = chartRef.current;\r\n        if (!chart) { console.warn(\"Chart instance not found.\"); return; }\r\n\r\n        const elements = getElementAtEvent(chart, event);\r\n        if (elements.length > 0) {\r\n            const { datasetIndex, index } = elements[0];\r\n            const dataset = chart.config.data.datasets[datasetIndex];\r\n            const dataPoint = dataset?.data[index];\r\n\r\n            if (dataPoint && activeChartTab === 'yield') {\r\n                const clickedTime = dataPoint.x;\r\n                // Check time ranges (inclusive start, exclusive end)\r\n                if (clickedTime >= 0 && clickedTime < 2) { setAnimationImageSrc(asset1Src); }\r\n                else if (clickedTime >= 8 && clickedTime < 15) { setAnimationImageSrc(day1Src); }\r\n                else if (clickedTime >= 35 && clickedTime < 40) { setAnimationImageSrc(day5Src); }\r\n                else { setAnimationImageSrc(null); } // Clear for other points\r\n            } else { setAnimationImageSrc(null); } // Clear if not yield tab or invalid point\r\n        } else { /* setAnimationImageSrc(null); */ } // Optional: clear on background click\r\n    };\r\n\r\n    // --- Chart Configuration Function ---\r\n    const getChartConfig = () => {\r\n        // ... (Chart config logic remains the same, including x-axis precision: 0) ...\r\n        const currentResultsSource = activeChartTab === 'mycelium' ? simulationResultsMycelium : simulationResultsMushroom;\r\n        const yieldColor = '#2E7D32'; const tempColor = '#C62828'; const myceliumColor = '#1976D2';\r\n        const textColor = '#333'; const gridColor = 'rgba(0, 0, 0, 0.08)';\r\n        const font = { family: 'Lexend', weight: '300' };\r\n        const options = {\r\n            responsive: true, maintainAspectRatio: false,\r\n            plugins: { legend: { display: true, labels: { color: textColor, font: font } }, tooltip: { enabled: true, bodyFont: font, titleFont: font }, title: { display: true, text: '', color: textColor, font: { ...font, size: 16, weight: '500'} } },\r\n            scales: {\r\n                x: { type: 'linear', title: { display: true, text: 'Time (Days)', color: textColor, font: font }, ticks: { color: textColor, font: font, precision: 0 }, grid: { color: gridColor }, min: 0, max: undefined }, // x-axis precision is 0\r\n                yYield: { type: 'linear', position: 'left', title: { display: true, text: 'Mushroom Yield (g)', color: yieldColor, font: font }, ticks: { color: yieldColor, font: font }, grid: { drawOnChartArea: true, color: gridColor }, beginAtZero: true, display: false },\r\n                yTemp: { type: 'linear', position: 'left', title: { display: true, text: 'Temperature (°C)', color: tempColor, font: font }, ticks: { color: tempColor, font: font }, grid: { drawOnChartArea: false }, display: false },\r\n                yMycelium: { type: 'linear', position: 'left', title: { display: true, text: 'Mycelium Density', color: myceliumColor, font: font }, ticks: { color: myceliumColor, font: font, callback: (value) => value.toFixed(2) }, grid: { drawOnChartArea: true, color: gridColor }, beginAtZero: true, suggestedMax: 1, display: false }\r\n            },\r\n            interaction: { mode: 'nearest', axis: 'x', intersect: false },\r\n        };\r\n        options.scales.yYield.display = false; options.scales.yTemp.display = false; options.scales.yMycelium.display = false;\r\n        if (!currentResultsSource || currentResultsSource.length === 0) { return { data: { datasets: [] }, options: options }; }\r\n        let datasets = []; let chartData = [...currentResultsSource]; let dataSourceName = '';\r\n        switch (activeChartTab) {\r\n            case 'yield': dataSourceName = 'Mushroom Sim'; options.plugins.title.text = `Yield Over Time (${dataSourceName})`; options.scales.yYield.display = true; datasets = [{ label: 'Mushroom Yield (g)', data: chartData.map(p => ({ x: p.time, y: Number.isFinite(p.MushroomYield) ? p.MushroomYield : null })), borderColor: yieldColor, backgroundColor: 'rgba(46, 125, 50, 0.1)', yAxisID: 'yYield', }]; options.scales.x.max = chartData.length > 0 ? chartData[chartData.length - 1].time : undefined; break;\r\n            case 'temp': dataSourceName = 'Mushroom Sim'; options.plugins.title.text = `Temperature Over Time (${dataSourceName})`; options.scales.yTemp.display = true; datasets = [{ label: 'Temperature (°C)', data: chartData.map(p => ({ x: p.time, y: Number.isFinite(p.Temp) ? p.Temp : null })), borderColor: tempColor, backgroundColor: 'rgba(198, 40, 40, 0.1)', yAxisID: 'yTemp', }]; options.scales.x.max = chartData.length > 0 ? chartData[chartData.length - 1].time : undefined; break;\r\n            case 'mycelium': dataSourceName = 'Mycelium Sim'; options.plugins.title.text = `Mycelium Growth (${dataSourceName})`; options.scales.yMycelium.display = true; let cutoffIndex = chartData.findIndex(p => p.Mycelium >= 0.9); let finalTime = chartData.length > 0 ? chartData[chartData.length - 1].time : 0; let cutoffReason = \"Simulation End\"; if (cutoffIndex !== -1) { chartData = chartData.slice(0, cutoffIndex + 1); finalTime = chartData[chartData.length - 1].time; cutoffReason = \"Mycelium >= 0.9\"; } else { const day30Index = chartData.findIndex(p => p.time >= 30); if (day30Index !== -1) { chartData = chartData.slice(0, day30Index + 1); finalTime = chartData[chartData.length - 1].time; cutoffReason = \"Day 30 Limit\"; } } options.scales.x.max = finalTime; if (cutoffReason !== \"Simulation End\") { options.plugins.title.text += ` (Stopped at ${cutoffReason})`; } datasets = [{ label: 'Mycelium Density', data: chartData.map(p => ({ x: p.time, y: Number.isFinite(p.Mycelium) ? p.Mycelium : null })), borderColor: myceliumColor, backgroundColor: 'rgba(25, 118, 210, 0.1)', yAxisID: 'yMycelium', }]; break;\r\n            default: datasets = [];\r\n        }\r\n        const finalDatasets = datasets && datasets.length > 0 ? datasets.map(ds => ({ ...ds, tension: 0.1, pointRadius: ds.data?.length > 150 ? 0.5 : (ds.data?.length > 50 ? 1 : 2), pointHoverRadius: 4, borderWidth: 1.5, spanGaps: true })).filter(ds => ds.data && ds.data.length > 0) : [];\r\n        return { data: { datasets: finalDatasets }, options: options };\r\n    };\r\n    // --- End getChartConfig function ---\r\n\r\n\r\n    // --- Render Logic ---\r\n    const chartConfig = getChartConfig();\r\n    const simulationDataReady = simulationResultsMushroom || simulationResultsMycelium;\r\n\r\n    return (\r\n        <div className=\"growth-simulation\">\r\n            {/* Header */}\r\n            <header className=\"simulation-header\">\r\n                <div className=\"logobox\">\r\n                    <div className=\"logo\"> <img src={logoSrc} alt=\"City Sprouts Logo\" /> </div>\r\n                </div>\r\n                <div className=\"batch-info\"> <span className=\"batch-name\">Batch: {batchName}</span> <span className=\"start-date\">Start: {formatDate_DDMMYYYY(startDate)}</span> </div>\r\n            </header>\r\n\r\n            {/* Main Content */}\r\n            <main className=\"main-content-grid\">\r\n                {/* Animation Area */}\r\n                <div className=\"animation-area content-card\">\r\n                    {animationImageSrc ? ( <img src={animationImageSrc} alt=\"Simulation state representation\" style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain', display: 'block', margin: 'auto' }} /> ) : ( <span>Animation / Visualization Area</span> )}\r\n                </div>\r\n\r\n                {/* Chart/Results Column */}\r\n                <div className=\"chart-results-column\">\r\n                    {/* Tabs */}\r\n                    <div className=\"tabs-container\">\r\n                         <button onClick={() => { setActiveChartTab('yield'); setAnimationImageSrc(null); }} className={`tab-button ${activeChartTab === 'yield' ? 'tab-button-active' : ''}`}> Yield </button>\r\n                         <button onClick={() => { setActiveChartTab('temp'); setAnimationImageSrc(null); }} className={`tab-button ${activeChartTab === 'temp' ? 'tab-button-active' : ''}`}> Temperature </button>\r\n                         <button onClick={() => { setActiveChartTab('mycelium'); setAnimationImageSrc(null); }} className={`tab-button ${activeChartTab === 'mycelium' ? 'tab-button-active' : ''}`}> Mycelium </button>\r\n                    </div>\r\n\r\n                    {/* Chart Area */}\r\n                    <div className=\"chart-area content-card\">\r\n                        {isLoading && <p className=\"loading-message\">Running simulations...</p>}\r\n                        {error && <p className=\"error-message\">Error: {error}</p>}\r\n                        {!isLoading && !error && simulationDataReady && ( chartConfig.data.datasets.length > 0 ? ( <div className=\"chart-container\"> <Line ref={chartRef} options={chartConfig.options} data={chartConfig.data} onClick={handleChartClick} /> </div> ) : ( <p className=\"no-data-message\">No simulation data to display for the '{activeChartTab}' chart.</p> ) )}\r\n                        {!isLoading && !error && !simulationDataReady && <p className=\"no-data-message\">Simulation results not available.</p>}\r\n                    </div>\r\n\r\n                    {/* Results Section */}\r\n                    <div className=\"results-section content-card\">\r\n                        <h3 className=\"results-heading\"> Simulation Results <span className=\"info-icon\" title=\"Projected yield is based on the Mushroom phase simulation. End date calculated from start date and duration.\">i</span> </h3>\r\n                        <div className=\"results-items\">\r\n                            <div className=\"result-item\"> <span className=\"result-label\">Projected Yield:</span> <span className=\"result-value\"> {isLoading ? '...' : error ? 'Error' : (finalSimulatedYield !== null && Number.isFinite(finalSimulatedYield)) ? `${finalSimulatedYield.toFixed(1)}g` : 'N/A'} </span> </div>\r\n                            <div className=\"result-item\"> <span className=\"result-label\">Projected End Date:</span> <span className=\"result-value\"> {isLoading ? '...' : error ? 'Error' : endDate} </span> </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </main>\r\n            <button onClick={handleDoneClick} className=\"done-button\" title=\"Save and Go to Landing Page\">Done</button>\r\n\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GrowthSimulation;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}